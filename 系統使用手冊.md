# NL2Cube 智慧分析系統 - 完整系統使用手冊

## 1. 系統概述

### 1.1 系統簡介
NL2Cube 智慧分析系統是一個基於自然語言查詢的商業智慧分析平台，讓您能夠使用日常語言來查詢和分析商業數據。系統整合了 AI 聊天功能、CrewAI 預測系統、向量資料庫和 n8n 工作流程自動化，提供智能化的分析建議、預測功能和業務流程自動化。

### 1.2 主要特色
- **自然語言查詢**：使用中文直接提問，無需學習複雜的查詢語法
- **多維度分析**：支援產品、人員、地區、時間等多維度數據分析
- **智能圖表**：自動生成適合的圖表類型，支援長條圖、圓餅圖等
- **AI 聊天助手**：整合 Gemini AI，提供專業的分析建議
- **NLG 報告生成**：自動生成自然語言分析總結和改善建議
- **CrewAI 預測系統**：多代理協作的智能預測功能
- **向量資料庫**：支援語義搜尋和文檔相似度分析
- **n8n 自動化**：可視化工作流程設計和業務流程自動化

### 1.3 系統架構
- **前端**：Web 介面，支援響應式設計
- **後端**：Python Flask MVC 架構
- **資料庫**：SQLite 星狀結構設計 + ChromaDB 向量資料庫
- **AI 整合**：Google Gemini API + CrewAI 預測系統
- **自動化**：n8n 工作流程引擎

## 2. 安裝與設定

### 2.1 系統需求
- **作業系統**：Windows 10+、macOS 10.14+、Linux
- **Python**：3.8 或更高版本
- **記憶體**：至少 8GB RAM（推薦 16GB）
- **硬碟空間**：至少 2GB 可用空間
- **網路**：穩定的網際網路連接（用於 AI API）

### 2.2 安裝步驟

#### 2.2.1 下載專案
```bash
# 克隆專案（如果使用 Git）
git clone <repository-url>
cd nl2cube-system

# 或直接下載並解壓縮專案檔案
```

#### 2.2.2 安裝 Python 依賴
```bash
# 建立虛擬環境（建議）
python -m venv venv

# 啟動虛擬環境
# Windows
venv\Scripts\activate
# macOS/Linux
source venv/bin/activate

# 安裝基礎依賴
pip install -r requirements.txt

# 安裝 CrewAI 依賴
pip install -r requirements_crewai.txt

# 安裝向量資料庫依賴
pip install -r requirements_vector.txt
```

#### 2.2.3 設定環境變數
建立 `.env` 檔案：
```bash
# .env
GEMINI_API_KEY=your_gemini_api_key_here
FLASK_SECRET_KEY=your_secret_key_here
FLASK_ENV=development
OPENAI_API_KEY=your_openai_api_key_here
CHROMA_DB_PATH=./chroma_db
N8N_WEBHOOK_URL=your_n8n_webhook_url_here
```

#### 2.2.4 啟動系統
```bash
# 啟動主要應用
python app.py

# 啟動向量資料庫應用
python app_vector.py

# 啟動 CrewAI 預測系統
python crewai_forecast.py
```

系統將在 `http://localhost:5010` 啟動。

### 2.3 首次設定

#### 2.3.1 資料庫初始化
系統會自動建立以下資料庫：
- **SQLite 資料庫**：`sales_cube.db`，包含銷售事實表和維度表
- **向量資料庫**：ChromaDB 資料庫，用於文檔向量化存儲
- **範例數據**：預設的銷售數據和文檔數據

#### 2.3.2 AI 功能設定
1. 申請 Google Gemini API 金鑰
2. 申請 OpenAI API 金鑰（用於 CrewAI）
3. 將金鑰設定到 `.env` 檔案中
4. 重新啟動系統

#### 2.3.3 n8n 整合設定
1. 安裝並啟動 n8n 服務
2. 設定 webhook URL
3. 配置工作流程觸發器

## 3. 核心功能使用指南

### 3.1 自然語言查詢

#### 3.1.1 基本查詢語法
系統支援多種自然語言查詢格式：

**期間比較查詢**
- "2025年06月的業績和2025年05月相比是好還是差?"
- "比較2025年Q1和2025年Q2的銷售表現"
- "2025年3月與2025年2月的差異分析"

**趨勢分析查詢**
- "2025年06月的銷售業績如何?"
- "顯示2025年Q1的產品銷售排行"
- "2025年3月的銷售數據"

**貢獻度分析查詢**
- "哪些產品貢獻最大?"
- "2025年06月各產品的貢獻度"
- "Q1期間的產品貢獻排行"

#### 3.1.2 查詢範例

**範例 1：期間比較**
```
查詢：2025年06月的業績和2025年05月相比是好還是差?
結果：
- 系統會顯示兩個月份的銷售數據對比
- 生成長條圖顯示各產品的表現
- 提供 NLG 分析報告
```

**範例 2：季度分析**
```
查詢：2025年Q1的銷售業績
結果：
- 顯示 Q1 期間的總體銷售數據
- 各產品的銷售排行
- 平均銷售額和交易次數
```

**範例 3：產品分析**
```
查詢：哪些產品貢獻最大?
結果：
- 顯示各產品的銷售貢獻度
- 生成圓餅圖顯示佔比
- 提供針對性改善建議
```

### 3.2 CrewAI 預測系統

#### 3.2.1 預測功能概述
CrewAI 預測系統是一個多代理協作的智能預測平台，能夠：
- 自動分析歷史數據趨勢
- 選擇最適合的預測模型
- 生成準確的預測結果
- 提供預測可信度評估

#### 3.2.2 預測代理角色

**數據分析代理**
- 負責數據預處理和特徵工程
- 識別數據模式和趨勢
- 處理缺失值和異常值

**預測代理**
- 選擇和訓練預測模型
- 執行預測計算
- 優化模型參數

**驗證代理**
- 評估預測準確性
- 檢查預測結果的合理性
- 提供預測可信度評分

**報告代理**
- 生成預測報告
- 提供決策建議
- 解釋預測結果

#### 3.2.3 預測模型類型

**SARIMAX 模型**
- 適用於：時間序列數據
- 特點：考慮季節性和趨勢
- 優勢：統計學基礎紮實

**Prophet 模型**
- 適用於：Facebook 開發的時間序列模型
- 特點：自動處理季節性和假日效應
- 優勢：易於使用和解釋

**LSTM 模型**
- 適用於：深度學習方法
- 特點：捕捉長期依賴關係
- 優勢：處理複雜模式

**集成模型**
- 適用於：多模型組合
- 特點：結合多個模型的優勢
- 優勢：提高預測穩定性

#### 3.2.4 預測停止條件

**準確度閾值停止**
- **MAE 閾值**：當平均絕對誤差低於設定閾值時停止
- **RMSE 閾值**：當均方根誤差低於設定閾值時停止
- **MAPE 閾值**：當平均絕對百分比誤差低於設定閾值時停止

**收斂性檢查停止**
- **梯度收斂**：當梯度變化小於閾值時停止
- **參數收斂**：當模型參數變化小於閾值時停止
- **損失收斂**：當損失函數變化小於閾值時停止

**過度擬合檢測停止**
- **驗證集性能**：當驗證集性能開始下降時停止
- **泛化能力**：當模型泛化能力下降時停止
- **複雜度控制**：當模型複雜度過高時停止

#### 3.2.5 預測使用流程

**步驟 1：選擇預測目標**
```
1. 登入預測系統
2. 選擇要預測的指標（如銷售額、數量等）
3. 設定預測時間範圍
4. 選擇預測模型類型
```

**步驟 2：配置預測參數**
```
1. 設定歷史數據範圍
2. 配置預測停止條件
3. 選擇特徵變數
4. 設定驗證集比例
```

**步驟 3：執行預測**
```
1. 點擊"開始預測"按鈕
2. 系統自動執行預測流程
3. 監控預測進度
4. 查看預測結果
```

**步驟 4：分析預測結果**
```
1. 查看預測準確性指標
2. 分析預測趨勢
3. 評估預測可信度
4. 下載預測報告
```

### 3.3 向量資料庫功能

#### 3.3.1 語義搜尋
向量資料庫支援基於語義的智能搜尋：

**文檔上傳**
```
1. 點擊"上傳文檔"按鈕
2. 選擇要上傳的文檔（支援 PDF、DOCX、TXT 等格式）
3. 系統自動進行向量化處理
4. 文檔存入向量資料庫
```

**語義查詢**
```
查詢：如何提高銷售業績？
結果：系統會返回與銷售業績相關的文檔，即使文檔中沒有完全相同的詞彙
```

**相似度分析**
```
1. 選擇基準文檔
2. 系統計算其他文檔的相似度
3. 按相似度排序顯示結果
4. 提供相似度分數
```

#### 3.3.2 文檔管理
- **文檔分類**：自動識別文檔類型和主題
- **標籤管理**：支援手動和自動標籤
- **版本控制**：追蹤文檔更新歷史
- **權限控制**：設定文檔存取權限

### 3.4 n8n 工作流程自動化

#### 3.4.1 工作流程設計
n8n 提供可視化的工作流程設計器：

**觸發器節點**
- **時間觸發**：定時執行工作流程
- **Webhook 觸發**：接收外部 API 請求
- **事件觸發**：監聽系統事件
- **手動觸發**：手動執行工作流程

**處理節點**
- **數據轉換**：轉換數據格式和結構
- **條件判斷**：根據條件執行不同分支
- **API 調用**：調用外部 API 服務
- **數據庫操作**：執行資料庫查詢和更新

**輸出節點**
- **通知發送**：發送郵件、簡訊等通知
- **數據存儲**：將結果存儲到資料庫或檔案
- **API 回應**：回應外部 API 請求
- **系統整合**：與其他系統進行整合

#### 3.4.2 常用工作流程範例

**數據同步工作流程**
```
觸發：每日凌晨 2 點
步驟：
1. 從 CRM 系統獲取客戶數據
2. 轉換數據格式
3. 更新本地資料庫
4. 發送同步完成通知
```

**預測觸發工作流程**
```
觸發：收到預測請求
步驟：
1. 驗證請求參數
2. 調用 CrewAI 預測 API
3. 處理預測結果
4. 發送預測完成通知
```

**異常監控工作流程**
```
觸發：系統監控告警
步驟：
1. 分析異常原因
2. 執行自動修復
3. 記錄處理日誌
4. 發送異常處理報告
```

## 4. 圖表與可視化功能

### 4.1 圖表類型

#### 4.1.1 長條圖（預設）
- **適用場景**：期間比較、趨勢分析
- **特點**：清楚顯示數值差異
- **配置選項**：顏色、標籤、軸線設定

#### 4.1.2 圓餅圖
- **適用場景**：佔比分析、貢獻度排行
- **特點**：直觀顯示比例關係
- **配置選項**：顏色、標籤、圖例設定

#### 4.1.3 折線圖
- **適用場景**：時間趨勢分析
- **特點**：清楚顯示變化趨勢
- **配置選項**：線條樣式、標記點、網格線

#### 4.1.4 散點圖
- **適用場景**：相關性分析
- **特點**：顯示兩個變數的關係
- **配置選項**：點的大小、顏色、標籤

### 4.2 圖表操作

#### 4.2.1 基本操作
1. **切換圖表類型**：點擊圖表類型選擇器
2. **查看詳細數據**：滑鼠懸停在圖表上
3. **下載圖表**：右鍵點擊圖表選擇下載
4. **全螢幕顯示**：點擊全螢幕按鈕

#### 4.2.2 進階操作
1. **數據篩選**：使用篩選器選擇特定數據
2. **圖表配置**：自定義圖表樣式和顏色
3. **數據鑽取**：點擊圖表元素查看詳細數據
4. **圖表比較**：並排顯示多個圖表

## 5. AI 聊天與 NLG 功能

### 5.1 AI 聊天功能

#### 5.1.1 聊天介面
- **位置**：分析總結報告下方
- **功能**：與 AI 專家進行對話
- **角色**：商業分析專家

#### 5.1.2 聊天範例

**詢問分析建議**
```
用戶：如何改善銷售表現較差的產品？
AI：根據分析結果，我建議您可以考慮以下策略：
1. 產品定位調整
2. 價格策略優化
3. 行銷活動加強
4. 銷售團隊培訓
```

**詢問數據解讀**
```
用戶：這個圖表顯示什麼意思？
AI：這個圖表顯示了各產品在兩個期間的銷售表現對比。
紅色長條代表當前期間，藍色長條代表比較期間。
可以看出產品A有顯著成長，而產品B略有下滑。
```

**詢問改善策略**
```
用戶：如何提升整體銷售業績？
AI：基於當前的數據分析，我建議：
1. 重點推廣表現優秀的產品
2. 針對下滑產品制定改善計劃
3. 加強銷售團隊的培訓
4. 優化產品組合策略
```

### 5.2 NLG 報告功能

#### 5.2.1 報告內容
系統會自動生成包含以下內容的分析報告：

**整體表現分析**
- 期間總銷售額
- 成長或下滑趨勢
- 變化百分比

**產品表現分析**
- 各產品的具體表現
- 成長和下滑的產品
- 貢獻度排行

**改善建議**
- 針對性改善策略
- 具體執行建議
- 預期效果評估

#### 5.2.2 報告範例
```
根據您的查詢「2025年06月的業績和2025年05月相比是好還是差?」，分析結果如下：

整體表現：
- 當前期間總銷售額：1,250,000 元
- 比較期間總銷售額：1,100,000 元
- 差異金額：+150,000 元
- 成長率：13.6%

產品表現：
- 產品A：成長 +80,000 元
- 產品B：成長 +45,000 元
- 產品C：下滑 -25,000 元

改善建議：
1. 繼續推廣產品A和B的成功策略
2. 針對產品C制定改善計劃
3. 加強銷售團隊培訓
4. 優化產品組合策略
```

## 6. 排程管理功能

### 6.1 排程系統概述
排程管理系統支援自動化任務執行，包括：
- 定期數據同步
- 自動預測執行
- 報告生成和發送
- 系統維護任務

### 6.2 排程設定

#### 6.2.1 基本排程設定
```json
{
  "task_name": "每日銷售數據同步",
  "schedule_type": "daily",
  "start_time": "02:00",
  "enabled": true,
  "retry_count": 3,
  "retry_interval": 300
}
```

#### 6.2.2 進階排程設定
```json
{
  "task_name": "週末預測任務",
  "schedule_type": "weekly",
  "days": ["saturday", "sunday"],
  "start_time": "09:00",
  "parameters": {
    "forecast_horizon": 30,
    "models": ["SARIMAX", "Prophet"]
  }
}
```

### 6.3 排程監控

#### 6.3.1 執行狀態監控
- **成功執行**：綠色狀態指示器
- **執行中**：藍色狀態指示器
- **執行失敗**：紅色狀態指示器
- **等待執行**：灰色狀態指示器

#### 6.3.2 執行日誌
```
2025-01-01 02:00:01 - 任務開始：每日銷售數據同步
2025-01-01 02:00:05 - 連接 CRM 系統成功
2025-01-01 02:00:15 - 數據同步完成，共同步 1,250 筆記錄
2025-01-01 02:00:16 - 任務完成：每日銷售數據同步
```

## 7. 進階功能

### 7.1 季度查詢

#### 7.1.1 季度語法
- "2025年Q1的銷售業績"
- "比較2025年Q1和Q2的表現"
- "Q1期間的產品分析"

#### 7.1.2 季度分析特色
- 自動識別季度格式
- 提供季度專用分析
- 包含交易次數和平均銷售額

### 7.2 多維度分析

#### 7.2.1 支援維度
- **產品維度**：產品名稱、產品類別
- **人員維度**：銷售人員、部門
- **地區維度**：銷售地區、區域類型
- **時間維度**：年、季、月、日

#### 7.2.2 維度查詢範例
```
產品分析：
- "哪些產品銷售最好？"
- "產品A的銷售趨勢"

人員分析：
- "誰的銷售業績最好？"
- "銷售團隊的表現分析"

地區分析：
- "哪個地區銷售最好？"
- "各地區的銷售比較"
```

### 7.3 針對性建議

#### 7.3.1 建議類型
系統會根據不同維度提供針對性建議：

**產品維度建議**
- 產品定位調整
- 價格策略優化
- 行銷活動加強

**人員維度建議**
- 銷售技巧培訓
- 績效激勵機制
- 團隊協作改善

**地區維度建議**
- 市場開發策略
- 區域資源配置
- 競爭優勢建立

## 8. 故障排除

### 8.1 常見問題

#### 8.1.1 查詢無結果
**問題**：查詢後顯示「沒有找到符合條件的數據」
**解決方案**：
1. 檢查查詢語法是否正確
2. 確認時間範圍是否有效
3. 檢查資料庫是否有對應數據

#### 8.1.2 AI 聊天無法使用
**問題**：AI 聊天功能無法回應
**解決方案**：
1. 檢查 Gemini API 金鑰是否正確設定
2. 確認網路連接正常
3. 檢查 API 使用配額

#### 8.1.3 圖表無法顯示
**問題**：查詢後圖表沒有顯示
**解決方案**：
1. 檢查瀏覽器是否支援 JavaScript
2. 清除瀏覽器快取
3. 重新整理頁面

#### 8.1.4 CrewAI 預測失敗
**問題**：預測系統執行失敗
**解決方案**：
1. 檢查 OpenAI API 金鑰設定
2. 確認預測參數是否正確
3. 檢查系統記憶體是否充足

#### 8.1.5 向量搜尋無結果
**問題**：向量搜尋沒有返回結果
**解決方案**：
1. 檢查文檔是否已成功上傳
2. 確認向量資料庫是否正常運行
3. 檢查搜尋查詢是否過於具體

### 8.2 錯誤訊息說明

#### 8.2.1 資料庫錯誤
```
錯誤：'NoneType' object is not iterable
原因：查詢結果為空
解決：檢查查詢條件或資料庫數據
```

#### 8.2.2 API 錯誤
```
錯誤：AI 服務暫時無法使用
原因：API 金鑰無效或網路問題
解決：檢查 API 設定和網路連接
```

#### 8.2.3 解析錯誤
```
錯誤：無法解析查詢語法
原因：查詢格式不支援
解決：使用標準查詢格式
```

#### 8.2.4 預測錯誤
```
錯誤：預測模型訓練失敗
原因：數據不足或格式不正確
解決：檢查數據品質和格式
```

### 8.3 效能優化

#### 8.3.1 查詢優化
- 使用具體的時間範圍
- 避免過於複雜的查詢
- 分批查詢大量數據

#### 8.3.2 系統優化
- 定期清理瀏覽器快取
- 關閉不必要的瀏覽器分頁
- 確保足夠的系統記憶體

#### 8.3.3 預測優化
- 選擇合適的預測模型
- 設定合理的預測參數
- 定期更新預測模型

## 9. 最佳實踐

### 9.1 查詢技巧

#### 9.1.1 有效查詢格式
```
✅ 好的查詢範例：
- "2025年06月的銷售業績"
- "比較2025年Q1和Q2的表現"
- "哪些產品貢獻最大？"

❌ 避免的查詢格式：
- "銷售數據"（太模糊）
- "所有東西"（範圍太大）
- "隨便看看"（無具體目標）
```

#### 9.1.2 查詢策略
1. **明確目標**：清楚知道要分析什麼
2. **具體時間**：使用明確的時間範圍
3. **適當範圍**：避免查詢過多數據
4. **逐步分析**：從整體到細節

### 9.2 預測最佳實踐

#### 9.2.1 數據準備
- 確保數據品質和完整性
- 處理缺失值和異常值
- 選擇合適的特徵變數

#### 9.2.2 模型選擇
- 根據數據特點選擇模型
- 考慮模型的解釋性需求
- 評估模型的計算複雜度

#### 9.2.3 參數調優
- 使用交叉驗證選擇參數
- 避免過度擬合
- 定期評估模型性能

### 9.3 分析流程

#### 9.3.1 標準分析流程
1. **整體概覽**：查看整體銷售表現
2. **期間比較**：分析成長或下滑趨勢
3. **產品分析**：識別表現優秀和需要改善的產品
4. **深入分析**：針對特定產品或期間進行詳細分析
5. **制定策略**：根據分析結果制定改善策略

#### 9.3.2 決策支援
- 使用 AI 聊天獲取專業建議
- 參考 NLG 報告的改善建議
- 結合多維度分析制定策略
- 利用預測結果進行規劃

### 9.4 報告使用

#### 9.4.1 報告解讀
- **數據準確性**：確認數據來源和計算邏輯
- **趨勢分析**：關注變化趨勢而非絕對數值
- **相對比較**：重點關注相對表現而非絕對表現

#### 9.4.2 行動建議
- **優先級排序**：根據影響力和可行性排序
- **資源配置**：合理分配改善資源
- **持續監控**：定期追蹤改善效果

## 10. 系統維護

### 10.1 日常維護

#### 10.1.1 資料庫維護
- 定期備份資料庫檔案
- 監控資料庫大小
- 檢查資料完整性

#### 10.1.2 系統更新
- 定期更新 Python 套件
- 檢查安全更新
- 備份重要設定檔案

#### 10.1.3 預測模型維護
- 定期評估模型性能
- 更新模型參數
- 清理過期的預測結果

### 10.2 效能監控

#### 10.2.1 系統效能
- 監控 CPU 和記憶體使用率
- 檢查磁碟空間
- 監控網路連接

#### 10.2.2 應用效能
- 監控查詢響應時間
- 檢查 API 使用量
- 監控錯誤率

#### 10.2.3 預測效能
- 監控預測準確性
- 檢查預測執行時間
- 評估預測資源使用

## 11. 技術支援

### 11.1 支援管道
- **文件查詢**：參考本使用手冊
- **錯誤報告**：記錄錯誤訊息和操作步驟
- **功能建議**：提供具體的使用場景和需求

### 11.2 聯絡資訊
- **技術支援**：系統管理員
- **功能諮詢**：業務分析師
- **緊急問題**：系統維護團隊

## 12. 更新日誌

### 12.1 版本歷史
- **v3.0**：整合 CrewAI 預測系統和向量資料庫
- **v2.5**：新增 n8n 工作流程自動化
- **v2.0**：整合 AI 聊天功能
- **v1.5**：新增季度查詢功能
- **v1.0**：基礎自然語言查詢功能

### 12.2 功能更新
- 新增多種圖表類型支援
- 改善自然語言解析準確度
- 優化 NLG 報告生成品質
- 增強 AI 聊天功能
- 整合 CrewAI 預測系統
- 新增向量資料庫功能
- 整合 n8n 自動化平台

---

**注意事項**：
1. 請定期備份重要數據
2. 保持系統和瀏覽器更新
3. 遵循最佳實踐建議
4. 如有問題請及時聯繫技術支援
5. 定期檢查預測模型性能
6. 監控系統資源使用情況

這份完整的使用手冊提供了 NL2Cube 智慧分析系統的完整使用指南，幫助用戶充分發揮系統功能，提升數據分析效率和預測準確性。 