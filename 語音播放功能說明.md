# 語音播放功能說明

## 功能概述

在分析總結報告(NLG)中新增了語音播放功能，播放內容為主要貢獻分析、其他維度參考分析，播放語音為國語新聞播放女生。

## 功能特色

### 🎤 語音合成
- 使用 Google Text-to-Speech (gTTS) 作為主要語音合成引擎
- 支援繁體中文語音合成
- 備用方案使用 pyttsx3 本地語音合成引擎

### 🔊 播放內容
- **主要貢獻分析**：從分析總結中提取主要貢獻因素
- **其他維度參考分析**：從分析總結中提取多維度分析結果
- **語音優化**：自動優化文字內容，使其更適合語音播放

### 🎵 播放控制
- 生成語音總結按鈕
- 播放/暫停控制
- 音頻載入狀態顯示
- 播放完成自動重置
- **播放速度控制**：支援 0.5x 到 2.0x 的播放速度調整
  - 預設播放速度：1.5x（加快1/2）
  - 可選速度：0.5x(慢速)、0.75x(較慢)、1.0x(正常)、1.25x(較快)、1.5x(快速)、2.0x(倍速)

## 安裝需求

### 必要套件
```bash
pip install gTTS>=2.3.0
pip install pyttsx3>=2.90
```

### 系統需求
- Python 3.7+
- 網路連線（用於 gTTS）
- 音頻播放支援

## 使用方法

### 1. 生成分析總結報告
首先需要執行分析查詢，生成包含主要貢獻分析和其他維度參考分析的總結報告。

### 2. 啟用語音播放功能
分析總結報告生成後，語音播放控制區域會自動顯示。

### 3. 生成語音總結
點擊「🎤 生成語音總結」按鈕，系統會：
- 提取主要貢獻分析內容
- 提取其他維度參考分析內容
- 組合並優化語音播放文字
- 使用 gTTS 生成國語女聲語音文件

### 4. 播放語音
語音生成完成後，點擊「▶️ 播放語音」按鈕收聽語音總結。

### 5. 調整播放速度
- **預設速度**：1.5x（加快1/2），語音播放速度比正常速度快50%
- **速度選擇**：使用播放速度下拉選單選擇合適的播放速度
  - 0.5x：慢速播放，適合仔細聆聽
  - 0.75x：較慢播放，適合理解內容
  - 1.0x：正常速度，標準播放
  - 1.25x：較快播放，節省時間
  - 1.5x：快速播放（預設），節省更多時間
  - 2.0x：倍速播放，快速瀏覽內容
- **即時調整**：可以在播放過程中調整播放速度

## API 端點

### 生成語音總結
```
POST /api/voice/summary
Content-Type: application/json

{
    "summary_text": "分析總結HTML內容",
    "voice_type": "mandarin_female"
}
```

### 獲取語音狀態
```
GET /api/voice/status
```

### 獲取音頻文件
```
GET /api/voice/audio/<filename>
```

## 技術實現

### 後端實現
- **分析控制器**：新增 `generate_voice_summary()` 方法
- **語音合成**：支援 gTTS 和 pyttsx3 雙引擎
- **內容提取**：使用正則表達式提取分析內容
- **語音優化**：自動優化文字格式，提升語音播放效果

### 前端實現
- **語音控制區域**：動態顯示語音播放控制
- **狀態管理**：實時顯示語音生成和播放狀態
- **音頻控制**：完整的播放、暫停、載入狀態管理
- **用戶體驗**：直觀的按鈕狀態和提示訊息

## 語音內容優化

### 文字處理
- 移除 HTML 標籤
- 優化標點符號
- 調整數字和單位格式
- 改善語音播放流暢度

### 語音設定
- 語言：繁體中文 (zh-tw)
- 語速：正常速度
- 音調：女聲（國語新聞播報風格）

## 錯誤處理

### 常見問題
1. **語音合成套件未安裝**
   - 解決方案：安裝 gTTS 或 pyttsx3
   - 錯誤訊息：語音合成功能不可用

2. **網路連線問題**
   - 解決方案：檢查網路連線
   - 備用方案：使用本地 pyttsx3 引擎

3. **音頻播放失敗**
   - 解決方案：檢查瀏覽器音頻支援
   - 錯誤訊息：音頻播放失敗，請稍後再試

### 狀態檢查
系統會自動檢查語音功能狀態，並在界面上顯示：
- ✅ 語音合成功能可用
- ❌ 語音合成功能不可用，請安裝相關套件

## 擴展功能

### 未來規劃
- 支援多種語音類型（男聲、女聲、不同語言）
- 語音速度調節
- 語音文件下載
- 批量語音生成

### 自定義設定
- 語音類型選擇
- 語速調整
- 音調設定
- 音量控制

## 注意事項

### 使用限制
- 語音文件會暫存在系統臨時目錄
- 建議定期清理臨時語音文件
- 網路連線不穩定時可能影響 gTTS 功能

### 最佳實踐
- 在網路穩定的環境下使用
- 定期檢查語音功能狀態
- 根據需要選擇合適的語音引擎
- 注意語音文件的存儲空間

## 技術支援

### 問題回報
如遇到語音播放功能問題，請檢查：
1. 套件安裝狀態
2. 網路連線狀況
3. 瀏覽器音頻支援
4. 系統音頻設定

### 開發者資訊
- 主要語音引擎：gTTS (Google Text-to-Speech)
- 備用語音引擎：pyttsx3
- 支援格式：MP3 (gTTS), WAV (pyttsx3)
- 開發語言：Python + JavaScript
