# 音頻播放故障排除指南

## 🚨 問題描述
生成語音後點選播放語音沒有聲音

## 🔍 故障診斷步驟

### 1. 檢查瀏覽器控制台
首先打開瀏覽器的開發者工具（F12），查看 Console 標籤頁是否有錯誤訊息：

```javascript
// 在瀏覽器控制台中輸入以下命令檢查音頻狀態
console.log('音頻支援檢查：');
console.log('Audio 對象：', typeof Audio);
console.log('Web Audio API：', typeof AudioContext);
```

### 2. 檢查音頻文件生成
在瀏覽器控制台中查看是否有以下日誌：
- 語音總結生成成功
- 音頻文件路徑
- 音頻文件大小

### 3. 檢查網路請求
在瀏覽器開發者工具的 Network 標籤頁中：
- 查看 `/api/voice/summary` 請求是否成功
- 查看 `/api/voice/audio/<filename>` 請求是否成功
- 檢查音頻文件的 HTTP 狀態碼和響應頭

## 🛠️ 常見問題解決方案

### 問題1：音頻文件未生成
**症狀**：點擊生成語音按鈕後沒有反應
**解決方案**：
1. 檢查後端日誌是否有錯誤
2. 確認已安裝語音合成套件：
   ```bash
   pip install gTTS>=2.3.0 pyttsx3>=2.90
   ```
3. 檢查網路連線（gTTS 需要網路）

### 問題2：音頻文件生成但無法播放
**症狀**：語音生成成功，但播放時沒有聲音
**解決方案**：
1. 檢查瀏覽器音頻權限
2. 確認瀏覽器音頻支援
3. 檢查音頻文件格式是否支援

### 問題3：音頻播放權限問題
**症狀**：瀏覽器阻止音頻播放
**解決方案**：
1. 點擊瀏覽器地址欄的音頻圖標
2. 允許網站播放音頻
3. 檢查瀏覽器設定中的音頻權限

### 問題4：音頻文件路徑錯誤
**症狀**：音頻文件路徑為空或無效
**解決方案**：
1. 檢查後端臨時目錄權限
2. 確認音頻文件確實存在
3. 檢查文件路徑格式

## 🔧 技術檢查清單

### 後端檢查
- [ ] 語音合成套件已安裝
- [ ] 臨時目錄有寫入權限
- [ ] 音頻文件成功生成
- [ ] API 端點正常響應
- [ ] 音頻文件 MIME 類型正確

### 前端檢查
- [ ] 瀏覽器支援 Audio API
- [ ] 音頻播放權限已授予
- [ ] 音頻文件 URL 正確
- [ ] 音頻事件監聽器正常
- [ ] 沒有 JavaScript 錯誤

### 網路檢查
- [ ] 音頻文件請求成功
- [ ] 音頻文件下載完成
- [ ] 沒有網路錯誤
- [ ] 音頻文件大小正常

## 🧪 測試方法

### 1. 使用音頻測試頁面
訪問 `/audio-test` 頁面進行完整測試：
- 瀏覽器音頻支援測試
- 內建音頻播放測試
- 語音合成測試
- 完整診斷測試

### 2. 手動測試音頻播放
在瀏覽器控制台中執行：
```javascript
// 創建測試音頻
const testAudio = new Audio();
testAudio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT';
testAudio.play().then(() => console.log('測試音頻播放成功')).catch(e => console.error('測試音頻播放失敗:', e));
```

### 3. 檢查音頻文件
在後端日誌中查看：
- 音頻文件生成路徑
- 文件大小
- 生成狀態

## 📋 故障排除檢查表

### 第一階段：基本檢查
- [ ] 瀏覽器是否支援音頻播放
- [ ] 音頻權限是否已授予
- [ ] 語音合成套件是否已安裝
- [ ] 網路連線是否正常

### 第二階段：功能測試
- [ ] 語音合成是否成功
- [ ] 音頻文件是否生成
- [ ] 音頻文件是否可以下載
- [ ] 音頻播放是否正常

### 第三階段：深度診斷
- [ ] 檢查後端日誌
- [ ] 檢查前端控制台
- [ ] 檢查網路請求
- [ ] 檢查音頻文件完整性

## 🚀 快速修復步驟

### 步驟1：重新安裝語音套件
```bash
pip uninstall gTTS pyttsx3
pip install gTTS>=2.3.0 pyttsx3>=2.90
```

### 步驟2：清理臨時文件
```bash
# 清理音頻臨時文件
rm -rf /tmp/voice_summary/*
```

### 步驟3：重啟應用
```bash
# 停止當前應用
# 重新啟動
python app_vector.py
```

### 步驟4：清除瀏覽器快取
- 清除瀏覽器快取和 Cookie
- 重新載入頁面
- 重新測試語音功能

## 📞 技術支援

如果以上步驟都無法解決問題，請提供以下信息：

1. **錯誤訊息**：瀏覽器控制台的完整錯誤訊息
2. **後端日誌**：應用程式的完整錯誤日誌
3. **環境信息**：
   - 作業系統版本
   - Python 版本
   - 瀏覽器版本
   - 已安裝的套件列表
4. **重現步驟**：詳細的問題重現步驟
5. **預期行為**：期望的正常行為描述

## 🔗 相關資源

- [音頻播放測試頁面](/audio-test)
- [語音播放功能說明](語音播放功能說明.md)
- [安裝腳本](install_voice_packages.py)
- [測試腳本](test_voice_function.py)

## 💡 預防措施

1. **定期檢查**：定期檢查語音功能狀態
2. **套件更新**：保持語音合成套件最新版本
3. **瀏覽器相容性**：測試不同瀏覽器的相容性
4. **錯誤監控**：監控音頻播放相關的錯誤
5. **備用方案**：準備離線語音合成方案
